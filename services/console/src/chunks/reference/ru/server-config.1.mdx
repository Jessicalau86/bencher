Бенчер API сервер требует настройки в формате JSON при запуске.
Конфигурация может быть предоставлена тремя способами:
- `BENCHER_CONFIG` переменная окружения: Значение должно быть установлено на конфигурацию в формате JSON
- `BENCHER_CONFIG_PATH` переменная окружения: Значение должно быть установлено на путь к файлу, содержащему конфигурацию JSON
- Файл, содержащий конфигурацию на JSON, расположенный в `./bencher.json`, относительно исполняемого файла сервера

Если конфигурация не найдена, загружается конфигурация по умолчанию.

Чтобы обновить конфигурацию во время работы сервера,
администратор может использовать команду CLI `bencher server config update`,
которая обращается по маршруту [PUT `/v0/server/config`](/docs/reference/api).
Все обновленные конфигурации сохраняются в переменной окружения `BENCHER_CONFIG`
и на диске по пути `BENCHER_CONFIG_PATH`.

Пример конфигурации JSON:

```
{
  "console": {
    "url": "https://bencher.example.com"
  },
  "security": {
    "issuer": "https://api.bencher.example.com",
    "secret_key": "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy"
  },
  "server": {
    "bind_address": "0.0.0.0:61016",
    "request_body_max_bytes": 1048576,
    "tls": {
      "type": "as_file",
      "cert_file": "/path/to/cert.pem",
      "key_file": "/path/to/key.pem"
    }
  },
  "logging": {
    "name": "Bencher API",
    "log": {
      "stderr_terminal": {
        "level": "info"
      }
    },
  },
  "database": {
    "file": "data/bencher.db",
    "data_store": {
      "service": "aws_s3"
      "access_key_id": "ABC123DoRemMiABC123",
      "secret_access_key": "AA3Chr-JSF5sUQqKwayx-FvCfZKsMev-5BqPpcFC3m7",
      "access_point": "arn:aws:s3:some-region-1:123456789:accesspoint/my-bucket/path/to/backup/dir"
    }
  },
  "smtp": {
    "hostname": "mailbonobo.com",
    "port": 587,
    "starttls": true,
    "username": "bencher"
    "secret": "WM3F2u9cqSNdBPLfy9sJ5kk9",
    "from_name": "Bencher",
    "from_email": "info@bencher.example.com"
  },
  "apm": {
    "sentry": {
      "dsn": "https://0123abc1023abc@987efg987efg.ingest.sentry.io/0123456789"
    }
  }
}
```

## `console`

|  Имя  |            Пример             |      По умолчанию       | Обяз. |                  Описание                   |
| :---: | :---------------------------: | :---------------------: | :---: | :-----------------------------------------: |
|  url  | "https://bencher.example.com" | "http://localhost:3000" |  Да   | Указывает URL для хоста консоли Bencher UI. |

## `security`

|    Имя     |                     Пример                     |   По умолчанию    | Обяз. |                                                                                                                                            Описание                                                                                                                                             |
| :--------: | :--------------------------------------------: | :---------------: | :---: | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   issuer   |       "https://api.bencher.example.com"        |   "bencher.dev"   |  Нет  |                                                                Указывает выпускающий орган JSON Web Token (JWT). **ВНИМАНИЕ** Изменение этого значения приведет к тому, что все ранее созданные JWT больше не проходят проверку.                                                                |
| secret_key | "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy" | Случайный UUID v4 |  Да   | Указывает ключ, используемый для генерации всех токенов. **ОН ДОЛЖЕН БЫТЬ ОЧЕНЬ БЕЗОПАСНЫМ!** Значение по умолчанию - это случайно сгенерированный [UUID v4](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)). При записи он будет выглядеть как `************`. |

# `server`

Этот раздел основан на [конфигурации сервера Dropshot](https://github.com/oxidecomputer/dropshot/tree/v0.9.0#dropshot-servers).

|          Имя           |       Пример        |  По умолчанию   |              Обяз.              |                                                                                                                               Описание                                                                                                                                |
| :--------------------: | :-----------------: | :-------------: | :-----------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|      bind_address      |   "0.0.0.0:61016"   | "0.0.0.0:61016" |               Да                |                   Указывает, что сервер должен привязываться к данному IP-адресу и TCP-порту. В общем случае серверы могут привязываться к более чем одному IP-адресу и порту, но это пока не поддерживается. Значение по умолчанию "127.0.0.1:0".                    |
| request_body_max_bytes |       1048576       |     1048576     |               Да                |                                                                  Указывает максимальное количество байт, разрешенное в теле запроса. Большие запросы получат ошибку 400. Значение по умолчанию 1024.                                                                  |
|        tls.type        |      "as_file"      |       ---       |               Нет               |                                                                    Указывает, используется ли и как информация о сертификате и ключе TLS. Действительные значения включают "as_file" и "as_bytes".                                                                    |
|     tls.cert_file      | "/path/to/cert.pem" |       ---       | Только если tls.type = as_file  | Указывает путь к файлу PEM, содержащему сертификат для идентификации сервера. Первый сертификат - это конечный сертификат субъекта, а оставшиеся - промежуточные сертификаты на пути к доверенному CA. Если указано, сервер будет прослушивать только TLS-соединения. |
|      tls.key_file      | "/path/to/key.pem"  |       ---       | Только если tls.type = as_file  |                                                       Указывает путь к файлу PEM, содержащему закрытый ключ, который будет использовать сервер. Если указано, сервер будет прослушивать только TLS-соединения.                                                        |
|       tls.certs        |         ---         |       ---       | Только если tls.type = as_bytes |                                                                                        То же, что и tls.cert_file, но предоставляемое в виде массива байт данных сертификата.                                                                                         |
|        tls.key         |         ---         |       ---       | Только если tls.type = as_bytes |                                                                                            То же, что и tls.key_file, но предоставляемое в виде массива байт данных ключа.                                                                                            |