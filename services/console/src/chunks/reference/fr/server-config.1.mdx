Le serveur API Bencher nécessite une configuration JSON au démarrage.
La configuration peut être fournie de trois manières :
- Variable d'environnement `BENCHER_CONFIG` : la valeur doit être définie à la configuration JSON
- Variable d'environnement `BENCHER_CONFIG_PATH` : la valeur doit être définie pour le cheminement d'un fichier contenant la configuration JSON
- Un fichier contenant la configuration JSON situé à `./bencher.json`, relatif à l'exécutable du serveur

Si aucune configuration n'est trouvée, alors une configuration par défaut est chargée.

Pour mettre à jour la configuration pendant que le serveur fonctionne,
un administrateur peut utiliser la commande du CLI `bencher server config update`
qui atteint la route [PUT `/v0/server/config`](/docs/reference/api).
Toutes les configurations mises à jour sont enregistrées dans la variable d'environnement `BENCHER_CONFIG`
et sur le disque à `BENCHER_CONFIG_PATH`.

Exemple de configuration JSON :

```
{
  "console": {
    "url": "https://bencher.example.com"
  },
  « security »: {
    "issuer": "https://api.bencher.example.com",
    "secret_key": "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy"
  },
  "server": {
    "bind_address": "0.0.0.0:61016",
    "request_body_max_bytes": 1048576,
    "tls": {
      "type": "as_file",
      "cert_file": "/path/to/cert.pem",
      "key_file": "/path/to/key.pem"
    }
  },
  "logging": {
    "name": "Bencher API",
    "log": {
      "stderr_terminal": {
        "level": "info"
      }
    },
  },
  "database": {
    "file": "data/bencher.db",
    "data_store": {
      "service": "aws_s3"
      "access_key_id": "ABC123DoRemMiABC123",
      "secret_access_key": "AA3Chr-JSF5sUQqKwayx-FvCfZKsMev-5BqPpcFC3m7",
      "access_point": "arn:aws:s3:some-region-1:123456789:accesspoint/my-bucket/path/to/backup/dir"
    }
  },
  "smtp": {
    "hostname": "mailbonobo.com",
    "port": 587,
    "starttls": true,
    "username": "bencher"
    "secret": "WM3F2u9cqSNdBPLfy9sJ5kk9",
    "from_name": "Bencher",
    "from_email": "info@bencher.example.com"
  },
  "apm": {
    "sentry": {
      "dsn": "https://0123abc1023abc@987efg987efg.ingest.sentry.io/0123456789"
    }
  }
}
```

## `console`

| Nom   |            Exemple               |         Par Défaut        | Obligatoire |                    Description                     |
| :---: | :-----------------------------: | :----------------------: | :------: | :------------------------------------------------: |
|  url  | "https://bencher.example.com"  |  "http://localhost:3000"  |   Oui     | Spécifie l'URL de l'hôte de la console UI Bencher. |

## `security`

|    Nom      |                    Exemple                          |    Par Défaut     | Obligatoire |                                                                                                                                     Description                                                                                                                                       |
| :--------:  | :------------------------------------------------: | :-------------:  | :-----: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   issuer    |       "https://api.bencher.example.com"           | "bencher.dev"   |   Non   | Spécifie l'émetteur du Jeton Web JSON (JWT). **AVERTISSEMENT** Modifier cette valeur fera en sorte que tous les JWT précédemment générés ne soient plus valides.                                                                                                                    |
| secret_key  | "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy"   | UUID v4 aléatoire |   Oui    | Spécifie la clé utilisée pour générer tous les tokens. **CELA DOIT ÊTRE TRÈS SÉCURISÉ !** La valeur par défaut est un [UUID v4](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)) aléatoirement généré. Lorsqu'il est connecté, il apparaîtra obscurci comme `************`. |

# `server`

Cette section se base sur la [configuration du serveur Dropshot](https://github.com/oxidecomputer/dropshot/tree/v0.9.0#dropshot-servers).

|          Nom                 |       Exemple        |     Par Défaut         |          Obligatoire           |                                                                                                                                               Description                                                                                                                                                     |
| :--------------------------: | :------------------: | :--------------------: | :-------------------------:  | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|      bind_address            |   "0.0.0.0:61016"    | "0.0.0.0:61016"        |             Oui              | Spécifie que le serveur doit se lier à l'adresse IP et au port TCP donnés. En général, les serveurs peuvent se lier à plus d'une adresse IP et à un port, mais ce n'est pas (encore ?) pris en charge. Par défaut à "127.0.0.1:0".                                                                             |
| request_body_max_bytes       |       1048576        |     1048576            |             Oui             | Spécifie le nombre maximum d'octets autorisés dans un corps de requête. Les requêtes plus grandes recevront une erreur 400. Par défaut à 1024.                                                                                                                                                                  |
|        tls.type              |      "as_file"       |       ---              |             Non             | Spécifie si et comment les informations de certificat et de clé TLS sont fournies. Les valeurs valides incluent "as_file" et "as_bytes".                                                                                                                                                                          |
|     tls.cert_file            | "/path/to/cert.pem"  |       ---              | Seulement si tls.type = as_file  | Spécifie le chemin vers un fichier PEM contenant une chaîne de certificats permettant au serveur de s'identifier. Le premier certificat est le certificat final, et le reste sont des certificats intermédiaires menant à une CA de confiance. Si spécifié, le serveur écoutera uniquement pour les connexions TLS.  |
|      tls.key_file            | "/path/to/key.pem"   |       ---              | Seulement si tls.type = as_file   | Spécifie le chemin vers un fichier PKCS #8 encodé en PEM contenant la clé privée que le serveur utilisera. Si spécifié, le serveur écoutera uniquement pour les connexions TLS.                                                                                                                                      |
|       tls.certs              |           ---           |       ---              | Seulement si tls.type = as_bytes | Identique à tls.cert_file, mais fourni sous la forme d'un tableau d'octets de données de certificat.                                                                                                                                                                                                                     |
|        tls.key               |           ---           |       ---             | Seulement si tls.type = as_bytes  | Identique à tls.key_file, mais fourni sous la forme d'un tableau d'octets de données clés.                                                                                                                                                                                                                           |
