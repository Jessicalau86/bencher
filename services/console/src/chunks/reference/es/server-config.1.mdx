El Servidor API de Bencher requiere una configuración JSON al inicio.
La configuración puede proporcionarse de tres formas:
- Variable de entorno `BENCHER_CONFIG`: El valor debería estar configurado a la configuración JSON
- Variable de entorno `BENCHER_CONFIG_PATH`: El valor debería estar configurado a la ruta de un archivo que contiene la configuración JSON
- Un archivo que contiene la configuración JSON ubicado en `./bencher.json`, relativo al ejecutable del servidor

Si no se encuentra ninguna configuración, entonces se carga una configuración predeterminada.

Para actualizar la configuración mientras el servidor está ejecutándose,
un administrador puede usar el comando CLI `bencher server config update`
que se dirige a la ruta [PUT `/v0/server/config`](/docs/reference/api).
Todas las configuraciones actualizadas se guardan en la variable de entorno `BENCHER_CONFIG`
y en el disco en `BENCHER_CONFIG_PATH`.

Ejemplo de configuración JSON:

```
{
  "console": {
    "url": "https://bencher.example.com"
  },
  "security": {
    "issuer": "https://api.bencher.example.com",
    "secret_key": "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy"
  },
  "server": {
    "bind_address": "0.0.0.0:61016",
    "request_body_max_bytes": 1048576,
    "tls": {
      "type": "as_file",
      "cert_file": "/path/to/cert.pem",
      "key_file": "/path/to/key.pem"
    }
  },
  "logging": {
    "name": "Bencher API",
    "log": {
      "stderr_terminal": {
        "level": "info"
      }
    },
  },
  "database": {
    "file": "data/bencher.db",
    "data_store": {
      "service": "aws_s3"
      "access_key_id": "ABC123DoRemMiABC123",
      "secret_access_key": "AA3Chr-JSF5sUQqKwayx-FvCfZKsMev-5BqPpcFC3m7",
      "access_point": "arn:aws:s3:some-region-1:123456789:accesspoint/my-bucket/path/to/backup/dir"
    }
  },
  "smtp": {
    "hostname": "mailbonobo.com",
    "port": 587,
    "starttls": true,
    "username": "bencher"
    "secret": "WM3F2u9cqSNdBPLfy9sJ5kk9",
    "from_name": "Bencher",
    "from_email": "info@bencher.example.com"
  },
  "apm": {
    "sentry": {
      "dsn": "https://0123abc1023abc@987efg987efg.ingest.sentry.io/0123456789"
    }
  }
}
```

## `console`

| Nombre |            Ejemplo            |     Predeterminado      | Obligatorio |                         Descripción                         |
| :----: | :---------------------------: | :---------------------: | :---------: | :---------------------------------------------------------: |
|  url   | "https://bencher.example.com" | "http://localhost:3000" |     Sí      | Especifica la URL para el host de la consola de Bencher UI. |

## `security`

|   Nombre   |                    Ejemplo                     |  Predeterminado   | Obligatorio |                                                                                                                                                        Descripción                                                                                                                                                         |
| :--------: | :--------------------------------------------: | :---------------: | :---------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   issuer   |       "https://api.bencher.example.com"        |   "bencher.dev"   |     No      |                                                                                     Especifica el emisor del Token Web JSON (JWT). **ADVERTENCIA** Cambiar este valor hará que todos los JWT generados anteriormente ya no se validen.                                                                                     |
| secret_key | "UJu7Cpxb-zFaJYqXD-3mDDSDyj-ZvfxZFZs-X58xjxPy" | UUID v4 aleatorio |     Sí      | Especifica la clave utilizada para generar todos los tokens. **¡DEBE SER MUY SEGURA!** El valor predeterminado es un [UUID v4](https://es.wikipedia.org/wiki/Identificador_%C3%BAnico_universal#Versi%C3%B3n_4_(aleatoria)) generado aleatoriamente. Cuando se registra, aparecerá de manera ofuscada como `************`. |

# `server`

Esta sección se basa en la [configuración del servidor Dropshot](https://github.com/oxidecomputer/dropshot/tree/v0.9.0#dropshot-servers).

|         Nombre         |       Ejemplo       | Predeterminado  |         Obligatorio         |                                                                                                                                                      Descripción                                                                                                                                                      |
| :--------------------: | :-----------------: | :-------------: | :-------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|      bind_address      |   "0.0.0.0:61016"   | "0.0.0.0:61016" |             Sí              |                                          Especifica que el servidor debe vincularse a la IP y puerto TCP proporcionados. En general, los servidores pueden vincularse a más de una dirección IP y puerto, pero esto no es (¿aún?) compatible. Por defecto es "127.0.0.1:0".                                           |
| request_body_max_bytes |       1048576       |     1048576     |             Sí              |                                                                                Especifica el número máximo de bytes permitidos en el cuerpo de una solicitud. Las solicitudes más grandes recibirán un error 400. Por defecto es 1024.                                                                                |
|        tls.type        |      "as_file"      |       ---       |             No              |                                                                                         Especifica si y cómo se proporciona la información del certificado y llave TLS. Los valores válidos incluyen "as_file" y "as_bytes".                                                                                          |
|     tls.cert_file      | "/path/to/cert.pem" |       ---       | Solo si tls.tipo = as_file  | Especifica la ruta a un archivo PEM que contiene una cadena de certificados para que el servidor se identifique. El primer certificado es el certificado de entidad final, y los restantes son certificados intermedios en camino a una CA de confianza. Si se especifica, el servidor solo escuchará conexiones TLS. |
|      tls.key_file      | "/path/to/key.pem"  |       ---       | Solo si tls.tipo = as_file  |                                                                      Especifica la ruta a un archivo PEM codificado en PKCS #8 que contiene la llave privada que usará el servidor. Si se especifica, el servidor solo escuchará conexiones TLS.                                                                      |
|       tls.certs        |         ---         |       ---       | Solo si tls.tipo = as_bytes |                                                                                                            Idéntico a tls.archivo_cert, pero proporcionado como un array de bytes de datos de certificado.                                                                                                            |
|        tls.key         |         ---         |       ---       | Solo si tls.tipo = as_bytes |                                                                                                              Idéntico a tls.archivo_llave, pero proporcionado como un array de bytes de datos de llave.                                                                                                               |
